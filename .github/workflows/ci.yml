name: Continious Integration
on:
  pull_request:
    branches:
      - master
    paths-ignore:
      - '**.md'
      - '**.yml'
jobs:
  compile:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@v2
    - name: Setup Scala
      uses: actions/setup-java@v1
      with:
        java-version: 11
    - name: Compile
      run: sbt compile
    - name: Check Scala Format
      run: sbt scalafmtCheckAll
    - name: Check Sbt Format
      run: sbt scalafmtSbtCheck
    # - name: Unit Test with Coverage
    #   env:
    #     COVERALLS_REPO_TOKEN: ${{ secrets.COVERALLS_REPO_TOKEN }}
    #   run: |
    #     sbt coverage test
    #     sbt coverageReport coveralls
    # - name: Scapegoat
    #   run: sbt scapegoat
    # - name: Scala Style
    #   run: sbt scalastyle
    - name: Sonar Scala
      run: sbt \
        -Dsonar.host.url=https://sonarcloud.io \
        -Dsonar.organization=gastonschabas \
        -Dsonar.projectKey=gastonschabas_rumble-on-scala \
        -Dsonar.login=${SONAR_TOKEN} \
        clean coverage test coverageReport scapegoat sonarScan
    # - name: SonarCloud Scan
    #   uses: sonarsource/sonarcloud-github-action@master
    #   env:
    #     GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    #     SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}
